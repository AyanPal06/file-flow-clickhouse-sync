
# Prompts Used to Create the Bidirectional ClickHouse & Flat File Ingestion Tool

## Prompt 1: Initial Setup

You are building a complete web-based tool: **Bidirectional ClickHouse & Flat File Ingestion Tool**.

ğŸ”¥ Tech Stack:
- Backend: Python (FastAPI)
- Frontend: HTML/CSS + JavaScript
- Database: ClickHouse (local via Docker)
- File: Local .csv (e.g., pp-monthly-update-new-version.csv)
- Auth: JWT token for ClickHouse
- Containerization: Docker

ğŸ“¦ STEP 1: Project Structure (initialize this file tree)
project-root/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ clickhouse_client.py
â”‚   â”œâ”€â”€ file_handler.py
â”‚   â”œâ”€â”€ schemas.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ style.css
â”‚   â””â”€â”€ script.js
â”œâ”€â”€ data/
â”‚   â””â”€â”€ (used to store uploaded and ingested files)
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md

ğŸ“‚ STEP 2: Backend - Basic FastAPI App with File Upload
- `/health`: return "OK"
- `/upload-csv`: accepts CSV upload, saves in `data/`
- `/csv-schema`: accepts filename, returns column list using Pandas
- `/preview-csv`: returns first 100 rows

Add error handling for empty or malformed files.

ğŸ“¦ STEP 3: Docker Setup
- Write `Dockerfile` to containerize FastAPI app.
- Use `docker-compose.yml`:
  - Service 1: FastAPI (port 8000)
  - Service 2: ClickHouse (port 8123, HTTP)

ğŸ“¦ STEP 4: requirements.txt

âš™ï¸ STEP 5: Setup CORS middleware for JS frontend.

## Prompt 2: ClickHouse Integration and Frontend UI

ğŸ¯ CONTINUING the same project...

ğŸ“¦ STEP 6: ClickHouse Integration via FastAPI (in `clickhouse_client.py`)
- `/clickhouse-connect`: accepts host, port, db, user, JWT token â€” test connection
- `/clickhouse-tables`: returns list of tables in DB
- `/clickhouse-schema`: returns column names for a given table
- `/ingest-clickhouse-to-file`:
   - Params: table name, columns
   - Export those columns to CSV, save in `data/` folder
- `/ingest-file-to-clickhouse`:
   - Params: filename, selected columns, ClickHouse table name
   - Ingest CSV file into ClickHouse table

Use `clickhouse-connect` with JWT token authentication (pass via headers).

ğŸ“¦ STEP 7: Add Record Count & Error Handling
- All ingest routes should return:
   ```json
   { "status": "success", "records": 4582 }
   ```
   In case of failure:
   ```json
   { "status": "error", "message": "JWT token invalid" }
   ```

ğŸ–¥ï¸ STEP 8: Frontend UI (HTML + JS)
- Source Selector (Flat File / ClickHouse)
- If "Flat File":
  - File Upload input (.csv)
  - Delimiter input
  - Button: "Upload"
  - Button: "Fetch Schema"
  - Checkbox list of columns
  - Button: "Ingest to ClickHouse"
- If "ClickHouse":
  - Inputs: Host, Port, DB, User, JWT Token
  - Button: "Connect"
  - Dropdown: Tables
  - Checkbox list of columns
  - Button: "Ingest to File"
- Use fetch to call backend endpoints.

ğŸ–¼ï¸ STEP 9: Status Display
- Add an HTML section:
  - Status: Connecting / Uploading / Ingesting / Completed
  - Message box with record count or error

## Prompt 3: Advanced Features and Finalization

ğŸ¯ FINAL PROMPT for complete project...

âœ¨ STEP 10: Bonus Feature - Preview
- Add /preview-clickhouse: accepts table name & selected columns â†’ return first 100 rows
- Add preview for uploaded CSV (/preview-csv already built)
- Show preview in <table> on frontend before ingestion

âœ¨ STEP 11: Bonus Feature - Multi-Table Join
- Frontend:
  - Allow selection of multiple ClickHouse tables
  - Textbox: Enter JOIN conditions manually
- Backend:
  - /clickhouse-join-schema: accepts tables and join condition
  - Build JOIN SQL query
  - Return joined schema (column names)
  - /ingest-joined-clickhouse-to-file: run join query, export to CSV

âœ¨ STEP 12: Final Touches
- Add progress bar or spinner during ingestion
- Add input validation (required fields)
- Use friendly alerts for connection failures or schema mismatch

ğŸ“ STEP 13: README.md
- Instructions to build & run project:
  - docker-compose up --build
- FastAPI endpoints summary
- How to test CSV and ClickHouse ingestion
- Screenshots of working UI (optional)
- Mention any AI tools used

ğŸ“ STEP 14: prompts.txt
- Save these 3 prompts in a prompts.txt file in root directory.
